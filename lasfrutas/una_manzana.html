<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drag the fruit to the correct box</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga de Fuente Poppins (para emular Platform Medium) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Definición del color primario y fuente */
        :root {
            --flamingo-pink: #FF79AC;
            --eerie-black: #121118;
        }

        /* Aplica la fuente "Platform Medium" con fallback */
        .font-platform {
            font-family: 'Platform Medium', 'Poppins', sans-serif;
        }

        /* Estilos generales */
        body {
            background-color: white;
            color: var(--eerie-black);
        }

        /* Estilo para los botones de fruta */
        .fruit-button {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: grab;
            user-select: none;
            touch-action: none; /* Esencial para el manejo de touch */
        }
        .fruit-button:active {
            cursor: grabbing;
            box-shadow: 0 4px 15px rgba(255, 121, 172, 0.6);
        }

        /* Estilo para la zona de arrastre activa */
        .drop-zone-active {
            border-color: var(--flamingo-pink) !important;
            box-shadow: 0 0 15px rgba(255, 121, 172, 0.7);
        }

        /* Estilo del botón arrastrado para el efecto visual */
        .dragging {
            opacity: 0.7;
            z-index: 1000;
        }
    </style>
    
    <script>
        // Configuración de Tailwind para usar el color Flamingo Pink
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'flamingo-pink': '#FF79AC',
                        'eerie-black': '#121118',
                    },
                }
            }
        }
    </script>
</head>
<body class="font-platform min-h-screen p-4 md:p-8 flex flex-col items-center">

    <!-- Título Principal -->
    <h1 class="text-3xl md:text-5xl font-extrabold text-eerie-black mb-8 text-center">
        Drag the fruit to the correct box
    </h1>

    <!-- Contenedor del Juego -->
    <div id="game-container" class="w-full max-w-4xl bg-white p-6 rounded-xl shadow-2xl border-2 border-flamingo-pink/50">

        <!-- Área de la Imagen Actual -->
        <div id="image-area" class="flex flex-col items-center mb-6">
            <!-- Se oculta el h2 que mostraba el nombre de la fruta -->
            <h2 id="current-fruit-name" class="text-xl md:text-2xl font-bold text-eerie-black mb-4 h-8 invisible">Nombre Oculto</h2> 
            <!-- Se mantiene el onerror como fallback por si fallan las URLs externas -->
            <img id="fruit-image" src="" alt="Imagen de Fruta" class="rounded-xl object-contain h-48 w-full max-w-xs border-4 border-flamingo-pink/50 mb-4" onerror="this.onerror=null;this.src='https://placehold.co/200x200/CCCCCC/121118?text=Imagen+no+disponible';" />
            <!-- Caja de mensajes para feedback (inicialmente vacía) -->
            <p id="message-box" class="h-8 text-center font-semibold"></p>
        </div>

        <!-- Contenedor de Botones de Vocabulario (Origen de arrastre) -->
        <div class="mb-8">
            <div id="buttons-container" class="flex flex-wrap justify-center gap-3 p-4 bg-flamingo-pink/10 rounded-lg min-h-[5rem]">
                <!-- Botones de fruta se insertarán aquí por JavaScript -->
            </div>
        </div>

        <!-- Contenedores de Arrastre (Destino) -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            
            <!-- Zona de Arrastre "UN" (Masculino) -->
            <div id="drop-un" class="drop-zone p-4 md:p-6 rounded-xl border-4 border-dashed border-gray-300 bg-gray-50 flex flex-col items-center transition-all min-h-[12rem]" data-gender="un">
                <h3 class="text-3xl md:text-4xl font-extrabold text-eerie-black mb-4">UN</h3>
                <div id="un-fruits" class="flex flex-wrap gap-2 justify-center">
                    <!-- Botones colocados en "un" se insertarán aquí -->
                </div>
            </div>

            <!-- Zona de Arrastre "UNA" (Femenino) -->
            <div id="drop-una" class="drop-zone p-4 md:p-6 rounded-xl border-4 border-dashed border-gray-300 bg-gray-50 flex flex-col items-center transition-all min-h-[12rem]" data-gender="una">
                <h3 class="text-3xl md:text-4xl font-extrabold text-eerie-black mb-4">UNA</h3>
                <div id="una-fruits" class="flex flex-wrap gap-2 justify-center">
                    <!-- Botones colocados en "una" se insertarán aquí -->
                </div>
            </div>
        </div>
        
    </div>

    <!-- Modal de Finalización de Juego -->
    <div id="completion-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-full border-4 border-flamingo-pink">
            <h3 class="text-3xl font-bold text-flamingo-pink mb-4">Activity Finished!</h3>
            <p class="text-lg mb-6 text-eerie-black">You have correctly classified all the fruits!</p>
            <button onclick="initGame()" class="py-2 px-6 bg-flamingo-pink text-white font-bold rounded-full hover:bg-flamingo-pink/80 transition shadow-lg">Play Again</button>
        </div>
    </div>


    <script>
        // --- Game Data ---
        // URLs restauradas a las imágenes externas solicitadas por el usuario.
        const FRUIT_DATA = [
            { name: "Manzana", url: "https://th.bing.com/th/id/R.c6ef1c7c177ba0e205add120ea606bf5?rik=v3wGpu4bFxqMtA&riu=http%3a%2f%2fwww.ibereco.com%2fimagen%2fcompleta%2f0%2f0%2fmanzana-roja-unidad_1.jpg&ehk=YYUtD01LCi9sJPys3KZ4sp83JmIlX0wQrzg79GZBO3w%3d&risl=&pid=ImgRaw&r=0", gender: "una" },
            { name: "Banana", url: "https://cdn.mos.cms.futurecdn.net/42E9as7NaTaAi4A6JcuFwG.jpg", gender: "una" },
            { name: "Pera", url: "https://th.bing.com/th/id/R.309002da6781ad3327246e0a04d89f61?rik=42sAz1AWZH%2fVQg&riu=http%3a%2f%2fwww.goodwholefood.com%2fwp-content%2fuploads%2f2016%2f08%2fpear-single-green.jpg&ehk=sPnSKiP2vklPhFC9aSVdE7QrzonbniMvJi%2b4uL4kJi4%3d&risl=&pid=ImgRaw&r=0", gender: "una" },
            { name: "Sandía", url: "https://arc-anglerfish-arc2-prod-abccolor.s3.amazonaws.com/public/EZZOPPLGEREPNF3KJI26BWMYJM.jpg", gender: "una" },
            { name: "Naranja", url: "https://img.freepik.com/premium-photo/orange-fruit-with-leaves-white-table_253984-858.jpg?w=2000", gender: "una" },
            { name: "Fresa", url: "https://tse4.mm.bing.net/th/id/OIP.JSC-abLl-eP6ibfuwmncAQHaF7?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", gender: "una" },
            { name: "Piña", url: "https://www.gob.mx/cms/uploads/image/file/415269/pi_a_1.jpg", gender: "una" },
            { name: "Arándano", url: "https://1.bp.blogspot.com/-tVC7wvNIea0/XuPyYTssOaI/AAAAAAAACIU/ok-0eI_B6qos7we76I6ZUD6eyvk72H28QCLcBGAsYHQ/s1600/0D25B8C5-D5B3-4428-A22E-805197C8A523.jpeg", gender: "un" },
            { name: "Mango", url: "https://tse1.mm.bing.net/th/id/OIP.RaH6bGd4OLQ3Uyh-25j22gHaHa?cb=12&rs=1&pid=ImgDetMain&o=7&rm=3", gender: "un" },
            { name: "Limón", url: "https://premierfresh.com.au/wp-content/uploads/2021/01/limes.jpg", gender: "un" },
        ];

        // Game State
        let gameState = {
            currentIndex: 0,
            remainingFruits: [], 
            isDragging: false,
            draggedElement: null,
            startX: 0,
            startY: 0,
            initialLeft: 0,
            initialTop: 0,
        };

        // --- DOM Elements ---
        const $image = document.getElementById('fruit-image');
        const $messageBox = document.getElementById('message-box');
        const $buttonsContainer = document.getElementById('buttons-container');
        const $dropUn = document.getElementById('drop-un');
        const $dropUna = document.getElementById('drop-una');
        const $unFruits = document.getElementById('un-fruits');
        const $unaFruits = document.getElementById('una-fruits');
        const $completionModal = document.getElementById('completion-modal');
        const $currentFruitName = document.getElementById('current-fruit-name');

        /**
         * Initializes or restarts the game.
         */
        function initGame() {
            // Reset state
            gameState.currentIndex = 0;
            // Clone and shuffle array
            gameState.remainingFruits = [...FRUIT_DATA].sort(() => Math.random() - 0.5); 
            
            // Clear drop zones
            $unFruits.innerHTML = '';
            $unaFruits.innerHTML = '';
            
            // Hide completion modal
            $completionModal.classList.add('hidden');
            $completionModal.classList.remove('flex');
            
            renderGame();
        }

        /**
         * Renders the current fruit image and vocabulary buttons.
         */
        function renderGame() {
            if (gameState.currentIndex >= FRUIT_DATA.length) {
                // All fruits have been classified
                showCompletionModal();
                return;
            }

            const currentFruit = gameState.remainingFruits[gameState.currentIndex];
            
            // 1. Update Image (and hide the name, keeping the element for layout)
            $image.src = currentFruit.url;
            $image.alt = `Imagen de ${currentFruit.name}`;
            $currentFruitName.textContent = currentFruit.name; // Keep name in element, but style it invisible
            
            // 2. Render Buttons
            $buttonsContainer.innerHTML = ''; 
            
            // Get names of fruits already placed in drop zones
            const placedFruitNames = Array.from($unFruits.querySelectorAll('div')).map(el => el.getAttribute('data-fruit-name'))
                                     .concat(Array.from($unaFruits.querySelectorAll('div')).map(el => el.getAttribute('data-fruit-name')));

            // Show only buttons that have NOT been placed.
            FRUIT_DATA.forEach(fruit => {
                if (!placedFruitNames.includes(fruit.name)) {
                    $buttonsContainer.appendChild(createButton(fruit.name));
                }
            });

            // 3. Clear message box
            $messageBox.textContent = ''; 
            $messageBox.className = 'h-8 text-center font-semibold text-eerie-black';
        }

        /**
         * Creates a draggable button for a fruit.
         */
        function createButton(name) {
            const button = document.createElement('button');
            button.className = 'fruit-button py-2 px-4 bg-flamingo-pink text-white font-bold rounded-full shadow-md hover:shadow-lg transition-all transform hover:scale-105 active:scale-95 whitespace-nowrap';
            button.textContent = name;
            button.setAttribute('draggable', 'true');
            button.setAttribute('data-fruit-name', name);
            
            // Mouse events
            button.addEventListener('dragstart', handleDragStart);

            // Touch events
            button.addEventListener('touchstart', handleTouchStart);
            button.addEventListener('touchmove', handleTouchMove);
            button.addEventListener('touchend', handleTouchEnd);
            
            return button;
        }
        
        // --- Drag & Drop Logic (Mouse) ---

        let draggedFruitName = null;

        function handleDragStart(e) {
            draggedFruitName = e.target.getAttribute('data-fruit-name');
            e.dataTransfer.setData('text/plain', draggedFruitName);
            
            e.target.classList.add('dragging'); 

            // Visual effect: Highlight drop zones
            $dropUn.classList.add('drop-zone-active');
            $dropUna.classList.add('drop-zone-active');
        }
        
        function handleDragOver(e) {
            e.preventDefault(); 
        }

        function handleDrop(e) {
            e.preventDefault();
            
            // Clear visual effects
            $dropUn.classList.remove('drop-zone-active');
            $dropUna.classList.remove('drop-zone-active');
            
            // Get the name of the dragged fruit
            let droppedName = e.dataTransfer ? e.dataTransfer.getData('text/plain') : draggedFruitName;
            
            if (!droppedName) return; 

            const targetZone = e.currentTarget;
            const targetGender = targetZone.getAttribute('data-gender');
            
            const currentFruit = gameState.remainingFruits[gameState.currentIndex];

            // 1. Check if the dragged name matches the displayed image
            if (droppedName !== currentFruit.name) {
                // Show a generic "Try again" message instead of revealing the correct fruit name.
                showMessage(`❌ Incorrect. Try again.`, 'text-red-600');
                return;
            }

            // 2. Check for the correct gender box
            if (targetGender !== currentFruit.gender) {
                // Message in English (This is for the case where the fruit name is correct, but the article (UN/UNA) is wrong)
                showMessage(`❌ Correct fruit name, wrong box. The gender of ${currentFruit.name} is "${currentFruit.gender.toUpperCase()}".`, 'text-red-600');
                return;
            }

            // 3. Success!
            // Message in English
            showMessage(`✅ Correct! ${currentFruit.gender.toUpperCase()} ${currentFruit.name}.`, 'text-green-600');
            
            // Remove the original button from the vocabulary area
            const originalButton = $buttonsContainer.querySelector(`[data-fruit-name="${droppedName}"]`);
            if (originalButton) {
                originalButton.remove();
            }

            // Create a static copy for the drop zone
            const placedDiv = document.createElement('div');
            placedDiv.className = 'py-1 px-3 bg-flamingo-pink text-white font-semibold text-sm rounded-full shadow-inner';
            placedDiv.textContent = droppedName;
            placedDiv.setAttribute('data-fruit-name', droppedName);
            
            targetZone.querySelector('div').appendChild(placedDiv);
            
            // Advance to the next game step
            gameState.currentIndex++;
            setTimeout(renderGame, 500);
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging'); 
            $dropUn.classList.remove('drop-zone-active');
            $dropUna.classList.remove('drop-zone-active');
            draggedFruitName = null;
        }
        
        // --- Drag & Drop Logic (Touch) ---
        
        function handleTouchStart(e) {
            e.preventDefault(); 
            
            gameState.isDragging = true;
            
            const touch = e.touches[0];
            
            gameState.startX = touch.clientX;
            gameState.startY = touch.clientY;
            
            const originalElement = e.currentTarget;
            const rect = originalElement.getBoundingClientRect();
            gameState.initialLeft = rect.left;
            gameState.initialTop = rect.top;

            // Clone button for dragging
            const clone = originalElement.cloneNode(true);
            clone.id = 'touch-drag-clone';
            clone.classList.add('dragging', 'transition-none'); 
            clone.style.position = 'absolute'; 
            clone.style.width = `${rect.width}px`; 
            clone.style.height = `${rect.height}px`; 
            clone.style.left = `${rect.left}px`;
            clone.style.top = `${rect.top}px`;
            
            document.body.appendChild(clone);
            
            gameState.draggedElement = clone;

            // Highlight drop zones
            $dropUn.classList.add('drop-zone-active');
            $dropUna.classList.add('drop-zone-active');
        }

        function handleTouchMove(e) {
            if (!gameState.isDragging || !gameState.draggedElement) return;

            const touch = e.touches[0];
            const dx = touch.clientX - gameState.startX;
            const dy = touch.clientY - gameState.startY;

            gameState.draggedElement.style.left = `${gameState.initialLeft + dx}px`;
            gameState.draggedElement.style.top = `${gameState.initialTop + dy}px`;
        }

        function handleTouchEnd(e) {
            if (!gameState.isDragging || !gameState.draggedElement) return;

            gameState.isDragging = false;
            
            // Find the center position of the dragged element
            const rect = gameState.draggedElement.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            let dropped = false;
            let targetZone = null;
            
            // Find element under the center point
            const elementUnderCenter = document.elementFromPoint(centerX, centerY);

            if (elementUnderCenter) {
                targetZone = elementUnderCenter.closest('.drop-zone');
                if (targetZone) {
                    dropped = true;
                }
            }

            // Execute drop logic if successful
            if (dropped) {
                const droppedName = gameState.draggedElement.getAttribute('data-fruit-name');
                const simulatedEvent = {
                    preventDefault: () => {},
                    currentTarget: targetZone,
                    dataTransfer: { getData: () => droppedName } 
                };
                
                handleDrop(simulatedEvent);
            } else {
                // Message in English
                showMessage('The button was not dropped on a valid box.', 'text-gray-500');
            }

            // Cleanup (remove the clone)
            gameState.draggedElement.remove(); 
            gameState.draggedElement = null; 
            
            // Clear drop zone visual effects
            $dropUn.classList.remove('drop-zone-active');
            $dropUna.classList.remove('drop-zone-active');
        }
        
        /**
         * Shows a temporary message.
         */
        function showMessage(text, colorClass) {
            $messageBox.textContent = text;
            $messageBox.className = `h-8 text-center font-semibold ${colorClass}`;
        }
        
        /**
         * Shows the completion modal.
         */
        function showCompletionModal() {
            $completionModal.classList.remove('hidden');
            $completionModal.classList.add('flex');
            $image.src = "https://placehold.co/200x200/FF79AC/121118?text=FIN";
            $currentFruitName.textContent = "¡Actividad Completa!";
        }


        // --- Game Initialization and Global Event Listeners ---
        window.onload = function() {
            initGame();

            // Add drop listeners for destination zones (for mouse)
            $dropUn.addEventListener('dragover', handleDragOver);
            $dropUn.addEventListener('drop', handleDrop);
            $dropUna.addEventListener('dragover', handleDragOver);
            $dropUna.addEventListener('drop', handleDrop);
            
            // Listener to clear mouse drag state
            document.addEventListener('dragend', handleDragEnd);
        };
    </script>
</body>
</html>
